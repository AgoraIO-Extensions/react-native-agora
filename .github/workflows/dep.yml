name: Update dependencies

on:
  workflow_dispatch:
    inputs:
      dependencies-content:
        description: The content of dependencies
        required: true
        type: string
        default: |
          打包助手 11-7 16:49
          Iris: Artifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/mac/iris_4.2.6-build.1_DCG_Mac_Video_20231107_0433.zip PrivateArtifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/mac/iris_4.2.6-build.1_DCG_Mac_Video_20231107_0433_private.zip CDN: https://download.agora.io/sdk/release/iris_4.2.6-build.1_DCG_Mac_Video_20231107_0433.zip Cocoapods: pod 'AgoraIrisRTC_macOS', '4.2.6-build.1'
          
          打包助手 11-7 16:51
          Iris: Artifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/ios/iris_4.2.6-build.1_DCG_iOS_Video_20231107_0433.zip PrivateArtifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/ios/iris_4.2.6-build.1_DCG_iOS_Video_20231107_0433_private.zip CDN: https://download.agora.io/sdk/release/iris_4.2.6-build.1_DCG_iOS_Video_20231107_0433.zip Cocoapods: pod 'AgoraIrisRTC_iOS', '4.2.6-build.1'
          
          打包助手 11-7 16:52
          Iris: Artifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/android/iris_4.2.6-build.1_DCG_Android_Video_20231107_0433.zip PrivateArtifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/android/iris_4.2.6-build.1_DCG_Android_Video_20231107_0433_private.zip CDN: https://download.agora.io/sdk/release/iris_4.2.6-build.1_DCG_Android_Video_20231107_0433.zip Maven: implementation 'io.agora.rtc:iris-rtc:4.2.6-build.1'
          
          打包助手 11-7 16:52
          Iris: Artifactory: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/windows/iris_4.2.6-build.1_DCG_Windows_Video_20231107_0433.zip Private: https://artifactory-api.bj2.agoralab.co/artifactory/CSDC_repo/EP/4.2.6/20231107/windows/iris_4.2.6-build.1_DCG_Windows_Video_20231107_0433_private.zip CDN: https://download.agora.io/sdk/release/iris_4.2.6-build.1_DCG_Windows_Video_20231107_0433.zip
          
          打包助手 11-7 16:52
          Packages: implementation 'io.agora.rtc:agora-full-preview:4.2.6-build.1'
          
          打包助手 11-7 16:52
          Packages: implementation 'io.agora.rtc:full-screen-sharing-special:4.2.6-build.1'
          
          打包助手 11-7 16:52
          Packages: pod 'AgoraRtcEngine_iOS_Preview', '4.2.6-build.1'
          
          打包助手 11-7 16:52
          Packages: pod 'AgoraRtcEngine_macOS_Preview', '4.2.6-build.1'
        

jobs:
  generate-codes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup
        uses: ./.github/actions/setup

      - name: Update dependencies
        uses: AgoraIO-Extensions/actions/.github/actions/dep@main
        with:
          dependencies-content: ${{ inputs.dependencies-content }}          
          target-files: |
            android/build.gradle
            example/ios/Podfile
            react-native-agora.podspec
          target-path: ${{ github.workspace }}
          github-token: ${{ secrets.GH_TOKEN }}

      - name: Update example
        run: |
          yarn pod-install example/ios

      - name: Create pull request
        uses: AgoraIO-Extensions/actions/.github/actions/pr@main
        with:
          target-repo: ${{ github.workspace }}
          target-branch: ${{ github.ref_name }}
          target-branch-name-surffix: |
            dep-update
          pull-request-title: |
            [AUTO] Update dependencies
          pull-request-body: |
            dependencies content: ${{ steps.dep.outputs.matches }}
          github-token: ${{ secrets.GH_TOKEN }}
          
